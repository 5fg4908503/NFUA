<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="robots" content="noindex, nofollow">
    <title>Admin Panel - Nazatians Friends Unity Association</title>
    <link rel="icon" type="image/png" href="site logo.png">
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f4f4f4;
            color: #333;
        }

        h1, h2, h3 {
            text-align: center;
            margin: 10px 0;
        }

        table {
            width: 90%;
            margin: 20px auto;
            border-collapse: collapse;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            background-color: white;
        }

        table thead tr {
            background-color: #deaa79;
            color: #ffffff;
        }

        th, td {
            padding: 10px;
            text-align: center;
            border: 1px solid #ddd;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        tr:hover {
            background-color: #ffe6a9;
        }

        th {
            font-weight: bold;
        }

        caption {
            font-size: 1.2em;
            margin-bottom: 10px;
        }

        form {
            margin: 20px auto;
            width: 90%;
            max-width: 700px;
            text-align: center;
            padding: 20px;
            background-color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        form .calendar,
        form .total {
            flex: 1;
            padding: 20px;
            background-color: #f9f9f9;
            border-radius: 5px;
            margin: 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.05);
            text-align: center;
            min-width: 250px;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        form .calendar h4, 
        form .total h4 {
            margin-bottom: 15px;
            font-size: 1.4em;
            color: #deaa79;
        }

        #currentDate,
        #totalCollection {
            font-size: 1.2em;
            line-height: 1.5;
            margin-top: 10px;
        }

        #totalCollection {
            color: #deaa79;
            font-weight: bold;
        }

        form input, form select, form button {
            margin: 10px 0;
            padding: 10px;
            font-size: 1em;
            width: 100%;
            max-width: 400px;
            box-sizing: border-box;
            border: 1px solid #ddd;
            border-radius: 5px;
        }

        form button {
            background-color: #deaa79;
            color: white;
            border: none;
            cursor: pointer;
        }

        form button:hover {
            background-color: #c78a57;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: pointer;
        }

        .tooltip .tooltip-text {
            visibility: hidden;
            width: 200px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 5px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            transform: translateX(-50%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .tooltip:hover .tooltip-text {
            visibility: visible;
            opacity: 1;
        }

        .message {
            text-align: center;
            margin-top: 10px;
            color: green;
            font-weight: bold;
        }

        .undo {
            display: inline-block;
            margin-top: 10px;
            background-color: #ff6666;
            color: white;
            padding: 5px 15px;
            border-radius: 5px;
            cursor: pointer;
        }

        .undo:hover {
            background-color: #e64c4c;
        }

        .home-btn {
            background-color: #deaa79;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            transition: background-color 0.3s;
        }

        .home-btn:hover {
            background-color: #c78a57;
        }

        @media screen and (max-width: 768px) {
            .home-btn {
                position: relative;
                margin: 10px;
                display: inline-block;
            }
        }

        .receipt {
            font-family: Arial, sans-serif;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-radius: 8px;
            background: white;
        }

        .receipt p {
            margin: 8px 0;
            font-size: 14px;
        }

        @media print {
            .receipt {
                width: 80mm;
                padding: 5mm;
            }
        }

        #whatsappModal input[type="tel"] {
            width: 100%;
            padding: 8px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        .modal-content button {
            margin-top: 10px;
            width: 100%;
        }

        .receipt {
            width: 300px;
            padding: 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            font-family: Arial, sans-serif;
        }

        .receipt p {
            margin: 8px 0;
            font-size: 14px;
        }

        #whatsappModal input[type="tel"] {
            width: 100%;
            padding: 8px;
            margin: 10px 0;
            border: 1px solid #ddd;
            border-radius: 4px;
        }

        #whatsappModal .modal-content {
            max-width: 300px;
        }

        form select option:disabled {
            background-color: #f0f0f0;
            color: #999;
            cursor: not-allowed;
        }

        form select {
            cursor: pointer;
        }

        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        @media screen and (max-width: 480px) {
            input, button {
                font-size: 16px !important; /* Prevents zoom on mobile */
                padding: 12px !important;
            }
            
            h3 {
                font-size: 18px !important;
            }
            
            .tab-panel {
                padding: 12px !important;
            }
        }

        /* Mobile-friendly styles */
        @media screen and (max-width: 768px) {
            /* Form layout */
            form {
                flex-direction: column;
                padding: 10px;
                width: 95%;
                margin: 10px auto;
            }

            form .calendar,
            form .total {
                width: 100%;
                margin: 5px 0;
                min-height: 100px;
            }

            /* Input fields */
            form input, 
            form select, 
            form button {
                width: 100%;
                font-size: 16px; /* Prevents zoom on iOS */
                padding: 12px;
                margin: 5px 0;
            }

            /* Table adjustments */
            table {
                width: 100%;
                margin: 10px 0;
                font-size: 14px;
                display: block;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            th, td {
                padding: 8px 4px;
                white-space: nowrap;
            }

            /* Fixed columns for ID and Name */
            table th:nth-child(1),
            table td:nth-child(1),
            table th:nth-child(2),
            table td:nth-child(2) {
                position: sticky;
                left: 0;
                background: inherit;
                z-index: 1;
            }

            table td:nth-child(2) {
                border-right: 2px solid #deaa79;
            }

            /* Headers */
            h1 {
                font-size: 1.5em;
                padding: 10px;
                margin-top: 50px;
            }

            h2 {
                font-size: 1.3em;
                padding: 8px;
            }

            h3 {
                font-size: 1.2em;
                padding: 6px;
            }

            /* Home button */
            .home-btn {
                position: fixed;
                top: 10px;
                left: 10px;
                z-index: 100;
                padding: 8px 15px;
                font-size: 0.9em;
            }

            /* Message display */
            .message {
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(255, 255, 255, 0.9);
                padding: 10px 20px;
                border-radius: 20px;
                box-shadow: 0 2px 5px rgba(0,0,0,0.2);
                z-index: 1000;
            }

            /* Recent payments panel */
            #recentPayments {
                max-height: 300px;
            }

            /* Receipt verification panel */
            #verificationResult {
                font-size: 14px;
                padding: 8px;
            }

            /* Admin actions buttons */
            #actionsPanel button {
                margin: 5px 0;
                width: 100%;
            }

            /* Touch-friendly tooltips */
            .tooltip .tooltip-text {
                width: 80%;
                left: 10%;
                transform: none;
            }
        }

        /* Additional improvements for very small screens */
        @media screen and (max-width: 360px) {
            table {
                font-size: 12px;
            }

            form input, 
            form select, 
            form button {
                font-size: 14px;
                padding: 10px;
            }

            .home-btn {
                font-size: 0.8em;
                padding: 6px 12px;
            }
        }

        /* Improve touch targets */
        @media (hover: none) {
            button, 
            input[type="submit"],
            select {
                min-height: 44px;
            }

            input[type="number"],
            input[type="text"] {
                min-height: 40px;
            }
        }
    </style>
</head>
<body>
    <div style="position: absolute; top: 20px; left: 20px;">
        <button onclick="window.location.href='index.html'" 
                style="background-color: #deaa79; 
                       color: white; 
                       padding: 10px 20px; 
                       border: none; 
                       border-radius: 5px; 
                       cursor: pointer; 
                       font-size: 1em;">
            ‚Üê Home Page
        </button>
    </div>
    <h1>Nazatians Friends Unity Association</h1>
    <h3>Sarulia, Demra, Dhaka 1361</h3>
    <h2>Monthly Payment Details</h2>
    <form id="updateForm">
        <div class="calendar" id="calendar">
            <h4>Arabic Calendar</h4>
            <div id="currentDate"></div>
        </div>
        <div>
            <div class="tooltip">
                <input type="number" id="id" placeholder="Enter ID" title="Enter the member's ID">
                <span class="tooltip-text">Enter the unique ID of the member.</span>
            </div>
            <div class="tooltip">
                <select id="month" title="Select the payment month">
                    <option value="">Select Month</option>
                    <option value="Romjan">Romjan</option>
                    <option value="Shawal">Shawal</option>
                    <option value="Jil Qad">Jil Qad</option>
                    <option value="Jil Hazz">Jil Hazz</option>
                    <option value="Muharrom">Muharrom</option>
                    <option value="Sofor">Sofor</option>
                    <option value="Robiul Awwal">Robiul Awwal</option>
                    <option value="Robius Sani">Robius Sani</option>
                    <option value="Jomadal Ula">Jomadal Ula</option>
                    <option value="Jomadal Akhiro">Jomadal Akhiro</option>
                    <option value="Rojob">Rojob</option>
                    <option value="Saban">Saban</option>
                </select>
            </div>
            <div class="tooltip">
                <input type="number" id="value" placeholder="Enter Value" title="Enter the payment amount">
                <span class="tooltip-text">Enter the payment amount for the selected month.</span>
            </div>
            <div class="tooltip" style="display: flex; align-items: center; margin: 10px 0;">
                <input type="checkbox" id="sendReceipt" style="width: auto; margin-right: 10px;">
                <label for="sendReceipt">Send WhatsApp Receipt</label>
                <span class="tooltip-text">Check this to send receipt via WhatsApp after payment</span>
            </div>
            <button type="button" onclick="updateCell()">Submit</button>
        </div>
        <div class="total">
            <h4>Total Collection</h4>
            <div id="totalCollection">‡ß≥ 0</div>
        </div>
    </form>
    <div class="message" id="message"></div>
    <div class="undo" id="undo" style="display: none;" onclick="undoLast()">Undo Last Action</div>
    <table id="table">
        <caption>Monthly Contributions for Each Member 1446 Hijri </caption>
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Romjan</th>
                <th>Shawal</th>
                <th>Jil Qad</th>
                <th>Jil Hazz</th>
                <th>Muharrom</th>
                <th>Sofor</th>
                <th>Robiul Awwal</th>
                <th>Robius Sani</th>
                <th>Jomadal Ula</th>
                <th>Jomadal Akhiro</th>
                <th>Rojob</th>
                <th>Saban</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td align="center">101</td>
                <td align="center">Zunayed Al Mahmud</td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
            </tr>
            <tr>
                <td align="center">102</td>
                <td align="center">Hasan Masud</td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
            </tr>
            <tr>
                <td align="center">103</td>
                <td align="center">Abdullah Afif</td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
            </tr>
            <tr>
                <td align="center">104</td>
                <td align="center">Abdullah Al Mahi</td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
            </tr>
            <tr>
                <td align="center">105</td>
                <td align="center">Imtiaz Hasan</td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
            </tr>
            <tr>
                <td align="center">106</td>
                <td align="center">Sah Poran</td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
            </tr>
            <tr>
                <td align="center">107</td>
                <td align="center">Alamin</td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
            </tr>
            <tr>
                <td align="center">108</td>
                <td align="center">Bayzid</td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
            </tr>
            <tr>
                <td align="center">109</td>
                <td align="center">Saim Rafi</td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
            </tr>
            <tr>
                <td align="center">110</td>
                <td align="center">Anas Mahmud</td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
            </tr>
            <tr>
                <td align="center">111</td>
                <td align="center">Mahmud Bin Nur</td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
            </tr>
            <tr>
                <td align="center">112</td>
                <td align="center">Nabil Mahmud</td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
            </tr>
            <tr>
                <td align="center">113</td>
                <td align="center">Abdur Rahman</td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
            </tr>
            <tr>
                <td align="center">114</td>
                <td align="center">Tawkir Rahman</td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
            </tr>
            <tr>
                <td align="center">115</td>
                <td align="center">Abdullah Al Kafi</td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
                <td align="center"></td>
            </tr>
        </tbody>
    </table>
    <div style="max-width: 1000px; margin: 20px auto; padding: 0 15px;">
        <!-- Mobile-friendly Tab Buttons -->
        <div style="display: flex; 
                    flex-wrap: nowrap; 
                    gap: 5px; 
                    margin-bottom: 20px; 
                    overflow-x: auto; 
                    -webkit-overflow-scrolling: touch; 
                    padding: 5px 0;
                    scrollbar-width: none;" 
             class="hide-scrollbar">
            <button onclick="showTab('receipts')" id="receiptsTab" 
                    style="background-color: #deaa79; 
                           color: white; 
                           padding: 12px 15px; 
                           border: none; 
                           border-radius: 5px; 
                           cursor: pointer; 
                           white-space: nowrap;
                           flex: 1;
                           min-width: 120px;
                           font-size: 14px;">
                üßæ Verify Receipt
            </button>
            <button onclick="showTab('actions')" id="actionsTab"
                    style="background-color: #deaa79; 
                           color: white; 
                           padding: 12px 15px; 
                           border: none; 
                           border-radius: 5px; 
                           cursor: pointer; 
                           white-space: nowrap;
                           flex: 1;
                           min-width: 120px;
                           font-size: 14px;">
                ‚ö° Actions
            </button>
            <button onclick="showTab('recent')" id="recentTab"
                    style="background-color: #deaa79; 
                           color: white; 
                           padding: 12px 15px; 
                           border: none; 
                           border-radius: 5px; 
                           cursor: pointer; 
                           white-space: nowrap;
                           flex: 1;
                           min-width: 120px;
                           font-size: 14px;">
                üìã Recent
            </button>
        </div>

        <!-- Mobile-friendly Tab Content -->
        <div class="tab-content">
            <!-- Receipt Verification Panel -->
            <div id="receiptsPanel" class="tab-panel" 
                 style="background: white; 
                        padding: 15px; 
                        border-radius: 10px; 
                        box-shadow: 0 4px 8px rgba(0,0,0,0.1); 
                        display: none;
                        margin-bottom: 15px;">
                <h3 style="color: #deaa79; margin-bottom: 15px; font-size: 18px;">Receipt Verification</h3>
                <div style="display: flex; flex-direction: column; gap: 10px;">
                    <input type="text" id="receiptId" 
                           placeholder="Enter Receipt Number" 
                           style="padding: 12px; 
                                  border: 1px solid #ddd; 
                                  border-radius: 5px;
                                  font-size: 16px;">
                    <button onclick="checkReceipt()" 
                            style="background-color: #deaa79; 
                                   color: white; 
                                   padding: 12px; 
                                   border: none; 
                                   border-radius: 5px; 
                                   cursor: pointer;
                                   font-size: 16px;">
                        Verify Receipt
                    </button>
                </div>
                <div id="verificationResult" style="margin-top: 15px; padding: 10px; border-radius: 5px; display: none;"></div>
            </div>

            <!-- Admin Actions Panel -->
            <div id="actionsPanel" class="tab-panel" 
                 style="background: white; 
                        padding: 15px; 
                        border-radius: 10px; 
                        box-shadow: 0 4px 8px rgba(0,0,0,0.1); 
                        display: none;
                        margin-bottom: 15px;">
                <h3 style="color: #deaa79; margin-bottom: 15px; font-size: 18px;">Admin Actions</h3>
                <div style="display: flex; flex-direction: column; gap: 12px;">
                    <button onclick="sendDueReminders()" 
                            style="background-color: #4CAF50; 
                                   color: white; 
                                   padding: 15px; 
                                   border: none; 
                                   border-radius: 5px; 
                                   cursor: pointer;
                                   font-size: 16px;">
                        üì¢ Send Due Reminders
                    </button>
                    <button onclick="downloadTableAsImage()" 
                            style="background-color: #2196F3; 
                                   color: white; 
                                   padding: 15px; 
                                   border: none; 
                                   border-radius: 5px; 
                                   cursor: pointer;
                                   font-size: 16px;">
                        üì• Download Table Image
                    </button>
                    <button onclick="clearAllData()" 
                            style="background-color: #ff6666; 
                                   color: white; 
                                   padding: 15px; 
                                   border: none; 
                                   border-radius: 5px; 
                                   cursor: pointer;
                                   font-size: 16px;">
                        üóëÔ∏è Clear All Payment Data
                    </button>
                </div>
            </div>

            <!-- Recent Payments Panel -->
            <div id="recentPanel" class="tab-panel" 
                 style="background: white; 
                        padding: 15px; 
                        border-radius: 10px; 
                        box-shadow: 0 4px 8px rgba(0,0,0,0.1); 
                        display: none;
                        margin-bottom: 15px;">
                <h3 style="color: #deaa79; margin-bottom: 15px; font-size: 18px;">Recent Payments</h3>
                <div id="recentPayments" 
                     style="max-height: 400px; 
                            overflow-y: auto; 
                            -webkit-overflow-scrolling: touch;">
                    <!-- Recent payments will be loaded here -->
                </div>
            </div>
        </div>
    </div>
    <div id="receiptTemplate" style="display: none;">
        <div class="receipt">
            <img src="site logo.png" 
                 alt="NFUA Logo" 
                 style="width: 80px; margin: 0 auto; display: block;">
            <h3 style="text-align: center; margin: 10px 0;">Payment Receipt</h3>
            <div style="margin: 15px 0;">
                <p><strong>ID:</strong> <span id="receipt-id"></span></p>
                <p><strong>Name:</strong> <span id="receipt-name"></span></p>
                <p><strong>Month:</strong> <span id="receipt-month"></span></p>
                <p><strong>Amount:</strong> ‡ß≥<span id="receipt-amount"></span></p>
                <p><strong>Date:</strong> <span id="receipt-date"></span></p>
            </div>
            <div style="text-align: center; font-size: 12px; margin-top: 20px;">
                Nazatians Friends Unity Association<br>
                Sarulia, Demra, Dhaka 1361
            </div>
        </div>
    </div>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.8.0/firebase-database-compat.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="whatsapp_numbers.js"></script>
    <script>
        // Initialize Firebase first
        const firebaseConfig = {
            apiKey: "AIzaSyA5S4DiTfTfcXDe0DxFEZQDr-OxE6rW3MA",
            authDomain: "nfua-updated.firebaseapp.com",
            projectId: "nfua-updated",
            storageBucket: "nfua-updated.firebasestorage.app",
            messagingSenderId: "708701107886",
            appId: "1:708701107886:web:7245d0aac4ed6c408a1f3f",
            measurementId: "G-3BCYZ9FP2F",
            databaseURL: "https://nfua-updated-default-rtdb.asia-southeast1.firebasedatabase.app"
        };
        
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // Add connection monitoring
        database.ref('.info/connected').on('value', (snap) => {
            if (snap.val() === true) {
                console.log('Connected to Firebase ‚úÖ');
            } else {
                console.log('Disconnected from Firebase ‚ùå');
            }
        });

        // Add these functions right after the Firebase initialization in your script section

        function saveToFirebase() {
            const table = document.getElementById("table");
            const tableData = {};
            
            for (let i = 1; i < table.rows.length; i++) {
                const row = table.rows[i];
                const id = row.cells[0].innerText;
                
                if (id) {
                    tableData[id] = {
                        id: id,
                        name: row.cells[1].innerText,
                        payments: {}
                    };
                    
                    for (let j = 2; j < row.cells.length; j++) {
                        const monthName = table.rows[0].cells[j].innerText;
                        const value = row.cells[j].innerText.trim();
                        tableData[id].payments[monthName] = value;
                    }
                }
            }

            return database.ref('tableData').set(tableData)
                .then(() => {
                    console.log("Data saved successfully:", tableData);
                    document.getElementById("message").innerText = "‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶∏‡ßá‡¶≠ ‡¶π‡¶Ø‡ßá‡¶õ‡ßá!";
                })
                .catch((error) => {
                    console.error("Error saving data:", error);
                    alert("‡¶°‡ßá‡¶ü‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡ßá‡¶õ‡ßá!");
                    throw error;
                });
        }

        function loadFromFirebase() {
            database.ref('tableData').on('value', (snapshot) => {
                try {
                    const tableData = snapshot.val();
                    if (tableData) {
                        const table = document.getElementById("table");
                        if (!table) {
                            console.error("Table element not found");
                            return;
                        }

                        if (tableData) {
                            const dataArray = Object.values(tableData);
                            
                            dataArray.forEach((rowData) => {
                                if (rowData && rowData.id) {
                                    const row = Array.from(table.rows).find(
                                        row => row.cells[0]?.innerText === rowData.id
                                    );
                                    
                                    if (row) {
                                        if (rowData.payments) {
                                            Object.entries(rowData.payments).forEach(([month, value]) => {
                                                const monthIndex = Array.from(table.rows[0].cells)
                                                    .findIndex(cell => cell.innerText === month);
                                                if (monthIndex !== -1) {
                                                    row.cells[monthIndex].innerText = value || '';
                                                }
                                            });
                                        }
                                    }
                                }
                            });
                            
                            updateTotalCollection();
                        }
                    }
                } catch (error) {
                    console.error("Error processing data:", error);
                }
            });
        }

        function updateCell() {
            const id = document.getElementById("id").value;
            const month = document.getElementById("month").value;
            const value = document.getElementById("value").value;
            const shouldSendReceipt = document.getElementById("sendReceipt").checked;
            
            if (!id || !month || !value) {
                alert("Please fill in all fields!");
                return;
            }

            try {
                const timestamp = Date.now();
                const random = Math.floor(Math.random() * 1000);
                const receiptId = `NFUA-${id}-${timestamp}-${random}`;

                const table = document.getElementById("table");
                const row = Array.from(table.rows).find(row => row.cells[0]?.innerText === id);
                if (row) {
                    const monthIndex = Array.from(table.rows[0].cells)
                        .findIndex(cell => cell.innerText === month);
                    if (monthIndex !== -1) {
                        row.cells[monthIndex].innerText = value;
                    }
                }

                saveToFirebase();
                
                const memberName = row.cells[1].innerText;
                const date = new Date().toLocaleDateString();

                database.ref(`receipts/${receiptId}`).set({
                    memberId: id,
                    memberName: memberName,
                    month: month,
                    amount: value,
                    date: date,
                    timestamp: timestamp,
                    receiptId: receiptId
                });

                document.getElementById("message").innerText = "Update successful!";
                updateTotalCollection();

                if (shouldSendReceipt) {
                    const number = membersWhatsApp[id];
                    if (number) {
                        // Get total paid amount and find last paid month
                        const row = Array.from(table.rows).find(row => row.cells[0]?.innerText === id);
                        let totalPaid = 0;
                        let dueMonths = [];

                        // Get current Islamic month
                        const today = new Date();
                        const islamicDate = today.toLocaleDateString('en-US', {
                            calendar: 'islamic-umalqura',
                            month: 'numeric',
                            numberingSystem: 'latn'
                        });
                        
                        const currentMonthIndex = parseInt(islamicDate.split('/')[0]) - 1;
                        
                        // Our month order
                        const islamicMonths = [
                            "Muharrom", "Sofor", "Robiul Awwal", "Robius Sani",
                            "Jomadal Ula", "Jomadal Akhiro", "Rojob", "Saban",
                            "Romjan", "Shawal", "Jil Qad", "Jil Hazz"
                        ];

                        if (row) {
                            // Calculate total paid and find due months
                            for (let j = 2; j < row.cells.length; j++) {
                                const monthName = table.rows[0].cells[j].innerText;
                                const monthIndex = islamicMonths.indexOf(monthName);
                                const cellValue = row.cells[j].innerText.trim();
                                
                                if (cellValue && !isNaN(cellValue)) {
                                    totalPaid += parseInt(cellValue);
                                } else if (monthIndex <= currentMonthIndex) {
                                    dueMonths.push(monthName);
                                }
                            }
                        }

                        const text = 
`üßæ *NFUA Payment Receipt*

*Member Details:*
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üë§ Name: ${memberName}
üÜî ID: ${id}
üìÖ Month: ${month}
üí∞ Amount: ‡ß≥${value}
üìÜ Date: ${date}
üîñ Receipt No: ${receiptId}

*Payment Summary:*
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üí≥ Total Paid: ‡ß≥${totalPaid}
üìå Due: ${dueMonths.length > 0 ? dueMonths.join(', ') : 'No dues'}

üåê Visit our website for more information:
https://5fg4908503.github.io/NFUA/

*Nazatians Friends Unity Association*
Sarulia, Demra, Dhaka`;

                        const whatsappUrl = `https://wa.me/${number.replace(/\+/g, '')}?text=${encodeURIComponent(text)}`;
                        window.open(whatsappUrl);
                    }
                }

                document.getElementById("id").value = "";
                document.getElementById("month").value = "";
                document.getElementById("value").value = "";
                document.getElementById("sendReceipt").checked = false;
                updateMonthDropdown();

            } catch (error) {
                console.error("Error updating data:", error);
                alert("Update failed! Please try again.");
            }
        }

        function updateTotalCollection() {
            const table = document.getElementById("table");
            let total = 0;
            for (let i = 1; i < table.rows.length; i++) {
                for (let j = 2; j < table.rows[i].cells.length; j++) {
                    const cellValue = table.rows[i].cells[j].innerText;
                    if (!isNaN(cellValue) && cellValue !== "") {
                        total += parseInt(cellValue);
                    }
                }
            }
            document.getElementById('totalCollection').innerText = `‡ß≥ ${total}`;
        }

        function downloadTableAsImage() {
            const table = document.getElementById('table');
            const message = document.getElementById("message");
            message.innerText = "‡¶õ‡¶¨‡¶ø ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶ö‡ßç‡¶õ‡ßá...";
            html2canvas(table, {
                scale: 2,
                backgroundColor: '#ffffff',
                logging: false,
                useCORS: true
            }).then(function(canvas) {
                const image = canvas.toDataURL("image/jpeg", 1.0);
                const downloadLink = document.createElement('a');
                downloadLink.href = image;
                const date = new Date();
                const filename = `NFUA_Table_${date.getFullYear()}-${date.getMonth()+1}-${date.getDate()}.jpg`;
                downloadLink.download = filename;
                document.body.appendChild(downloadLink);
                downloadLink.click();
                document.body.removeChild(downloadLink);
                message.innerText = "‡¶õ‡¶¨‡¶ø ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!";
                setTimeout(() => {
                    message.innerText = "";
                }, 3000);
            })
            .catch(function(error) {
                console.error('Error:', error);
                message.innerText = "‡¶¨‡¶ø ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶§‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!";
            });
        }

        function clearAllData() {
            const confirmClear = confirm("‚ö†Ô∏è Warning: This will delete ALL payment data and receipts. This action cannot be undone. Are you sure?");
            if (confirmClear) {
                const secondConfirm = confirm("Are you absolutely sure? All payment records will be permanently deleted.");
                if (secondConfirm) {
                    try {
                        database.ref('tableData').remove();
                        database.ref('receipts').remove();
                        
                        const table = document.getElementById("table");
                        for (let i = 1; i < table.rows.length; i++) {
                            const row = table.rows[i];
                            for (let j = 2; j < row.cells.length; j++) {
                                row.cells[j].innerText = '';
                            }
                        }
                        
                        document.getElementById('totalCollection').innerText = '‡ß≥ 0';
                        alert("All payment data has been cleared successfully!");
                        document.getElementById('recentPayments').innerHTML = '';
                        
                    } catch (error) {
                        console.error("Error clearing data:", error);
                        alert("Error clearing data. Please try again.");
                    }
                }
            }
        }

        // Add event listener for DOMContentLoaded
        document.addEventListener('DOMContentLoaded', () => {
            loadFromFirebase();
            updateArabicDate();
            loadRecentPayments();
            updateTotalCollection();
        });

        function loadRecentPayments() {
            const recentPaymentsDiv = document.getElementById('recentPayments');
            database.ref('receipts').orderByChild('timestamp').limitToLast(5).on('value', (snapshot) => {
                const payments = [];
                snapshot.forEach((childSnapshot) => {
                    payments.unshift(childSnapshot.val());
                });
                
                recentPaymentsDiv.innerHTML = payments.map(payment => `
                    <div style="border: 1px solid #ddd; padding: 10px; margin: 10px 0; border-radius: 5px; background: #f9f9f9;">
                        <div style="display: flex; justify-content: space-between; align-items: center;">
                            <div>
                                <strong>${payment.memberName}</strong> (ID: ${payment.memberId})
                                <br>
                                Month: ${payment.month} | Amount: ‡ß≥${payment.amount}
                            </div>
                            <div style="text-align: right; color: #666; font-size: 0.9em;">
                                ${payment.date}
                                <br>
                                <span style="font-size: 0.8em; color: #888;">${payment.receiptId}</span>
                            </div>
                        </div>
                    </div>
                `).join('');
            });
        }

        function updateArabicDate() {
            const today = new Date();
            const islamicMonths = [
                "Muharrom", "Sofor", "Robiul Awwal", "Robius Sani",
                "Jomadal Ula", "Jomadal Akhiro", "Rojob", "Saban",
                "Romjan", "Shawal", "Jil Qad", "Jil Hazz"
            ];
            
            try {
                const islamicDate = today.toLocaleDateString('en-US', {
                    calendar: 'islamic-umalqura',
                    day: 'numeric',
                    month: 'numeric',
                    year: 'numeric',
                    numberingSystem: 'latn'
                }).replace(' AH', '').replace('B', '').replace(/\s+/g, ' ').trim();
                
                // Parse the date parts
                const [month, day, year] = islamicDate.split('/');
                const monthIndex = parseInt(month) - 1;
                const currentMonth = islamicMonths[monthIndex];
                
                const formattedDate = `${currentMonth} ${day}, ${year.replace(/[^0-9]/g, '')} AH`;
                
                document.getElementById("currentDate").innerHTML = `
                    <div style="font-size: 1.2em;">${formattedDate}</div>
                `;
            } catch (error) {
                console.error('Error formatting Islamic date:', error);
                // Fallback to regular date if there's an error
                const dateStr = today.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
                document.getElementById("currentDate").innerHTML = `
                    <div style="font-size: 1.2em;">${dateStr}</div>
                `;
            }
        }

        // Add this new function to check paid months
        function updateMonthDropdown() {
            const id = document.getElementById("id").value;
            const monthSelect = document.getElementById("month");
            
            // Reset all options to enabled first
            Array.from(monthSelect.options).forEach(option => {
                option.disabled = false;
            });

            if (!id) return; // If no ID selected, keep all months enabled

            const table = document.getElementById("table");
            const row = Array.from(table.rows).find(row => row.cells[0]?.innerText === id);
            
            if (row) {
                // Check each month in the row
                Array.from(row.cells).forEach((cell, index) => {
                    if (index >= 2) { // Skip ID and Name columns
                        const monthName = table.rows[0].cells[index].innerText;
                        const value = cell.innerText.trim();
                        
                        // If there's a payment value, disable that month in dropdown
                        if (value) {
                            const option = Array.from(monthSelect.options).find(opt => opt.value === monthName);
                            if (option) {
                                option.disabled = true;
                            }
                        }
                    }
                });
            }
        }

        // Add event listener to ID input
        document.getElementById("id").addEventListener('change', updateMonthDropdown);

        // Add this function after your existing functions

        function sendDueReminders() {
            // Get current Islamic date and month
            const today = new Date();
            const islamicDate = today.toLocaleDateString('en-US', {
                calendar: 'islamic-umalqura',
                day: 'numeric',
                month: 'numeric',
                year: 'numeric',
                numberingSystem: 'latn'
            });
            
            // Get actual Hijri month index (1-12)
            const currentMonthIndex = parseInt(islamicDate.split('/')[0]) - 1;
            
            // Our display months in table order (starting from Ramadan)
            const tableMonths = [
                "Romjan", "Shawal", "Jil Qad", "Jil Hazz", 
                "Muharrom", "Sofor", "Robiul Awwal", "Robius Sani",
                "Jomadal Ula", "Jomadal Akhiro", "Rojob", "Saban"
            ];

            // Convert Hijri month index to our table month index
            // Muharram (index 0) is at position 4 in our table
            const tableMonthIndex = (currentMonthIndex + 4) % 12;
            const currentMonth = tableMonths[tableMonthIndex];

            // Get all members who haven't paid
            const table = document.getElementById("table");
            const unpaidMembers = [];

            for (let i = 1; i < table.rows.length; i++) {
                const row = table.rows[i];
                const memberId = row.cells[0].innerText;
                const memberName = row.cells[1].innerText;
                const dueMonths = [];
                let totalPaid = 0;

                // Check payments up to current month in table order
                for (let j = 2; j < row.cells.length; j++) {
                    const monthName = table.rows[0].cells[j].innerText;
                    const monthIndex = tableMonths.indexOf(monthName);
                    const cellValue = row.cells[j].innerText.trim();
                    
                    // Check if this month should be included in dues check
                    // Compare month positions relative to current month
                    if (monthIndex <= tableMonthIndex) {
                        if (cellValue && !isNaN(cellValue)) {
                            totalPaid += parseInt(cellValue);
                        } else {
                            dueMonths.push(monthName);
                        }
                    }
                }

                // Only add members who have dues
                if (dueMonths.length > 0) {
                    unpaidMembers.push({
                        id: memberId,
                        name: memberName,
                        dueMonths: dueMonths,
                        totalPaid: totalPaid,
                        contact: membersWhatsApp[memberId]
                    });
                }
            }

            if (unpaidMembers.length === 0) {
                alert(`No due payments found up to ${currentMonth}! üéâ`);
                return;
            }

            // Create reminder message
            const reminderMessage = 
`*NFUA Payment Due Reminder* ‚ö†Ô∏è
Date: ${islamicDate.replace(/\//g, '-')}

${unpaidMembers.map(member => 
`‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üë§ ${member.name}
üÜî ID: ${member.id}
üìÖ Due: ${member.dueMonths.join(', ')}
üí∞ Paid: ‡ß≥${member.totalPaid}
üì± Contact: ${member.contact}`
).join('\n\n')}

‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üåê Visit: https://5fg4908503.github.io/NFUA/

*Nazatians Friends Unity Association*
Sarulia, Demra, Dhaka`;

            // Send to admin (ID: 113)
            const adminNumber = membersWhatsApp['113'];
            if (adminNumber) {
                window.open(`https://wa.me/${adminNumber.replace(/\+/g, '')}?text=${encodeURIComponent(reminderMessage)}`);
            }
        }

        // Add this JavaScript for tab functionality
        function showTab(tabName) {
            // Hide all panels
            document.querySelectorAll('.tab-panel').forEach(panel => {
                panel.style.display = 'none';
            });
            
            // Reset all tab buttons
            document.querySelectorAll('[id$="Tab"]').forEach(tab => {
                tab.style.backgroundColor = '#deaa79';
            });
            
            // Show selected panel and highlight its tab
            document.getElementById(`${tabName}Panel`).style.display = 'block';
            document.getElementById(`${tabName}Tab`).style.backgroundColor = '#c78a57';
        }

        // Show first tab by default when page loads
        document.addEventListener('DOMContentLoaded', () => {
            showTab('receipts');
        });
    </script>
</body>
</html>

